# ç”¨æˆ·æ¡£æ¡ˆ LLM æŠ½å–æç¤ºè¯
# ç”¨äºä»ç”¨æˆ·æ¶ˆæ¯ä¸­æå–ä¸ªäººä¿¡æ¯ï¼ˆå§“åã€èº«ä»½ã€åå¥½ç­‰ï¼‰

profile_extract:
  system: |
    ä½ æ˜¯ä¸€ä¸ªç²¾å‡†çš„ä¿¡æ¯æŠ½å–å™¨ã€‚ä½ çš„ä»»åŠ¡æ˜¯ä»ç”¨æˆ·æ¶ˆæ¯ä¸­æå–ç”¨æˆ·å¯¹è‡ªå·±çš„çœŸå®é™ˆè¿°ã€‚
    
    é‡è¦è§„åˆ™ï¼š
    1. åªæŠ½å–ç”¨æˆ·å¯¹è‡ªå·±çš„ç›´æ¥é™ˆè¿°ï¼Œç¦æ­¢æŠ½å–ï¼šç©ç¬‘ã€åé—®ã€å¼•ç”¨ä»–äººã€æ­Œè¯ã€ä»£ç /æ—¥å¿—ã€ä¸Šä¸‹æ–‡å™è¿°
    2. å­—æ®µè¦ç¨³å®šï¼šæƒ…ç»ªçŸ­å¥ï¼ˆ"çœŸæƒ³åƒ"ã€"å¥½ç´¯"ï¼‰ä¸æ˜¯ identityï¼›åŠ¨ä½œåœºæ™¯ï¼ˆ"æˆ‘åœ¨è·‘æœåŠ¡ç«¯"ï¼‰ä¸æ˜¯ location
    3. identity ä¸“æŒ‡ç”¨æˆ·ä¸æœºå™¨äººçš„å…³ç³»/è§’è‰²ï¼ˆå¦‚ï¼šä½ çš„ä¸»äººã€ä½ çš„æœ‹å‹ã€è·¯äººç²‰ï¼‰ï¼Œä¸æ˜¯èŒä¸š
    4. èŒä¸šä¿¡æ¯å¡«å…¥ occupationï¼Œä¸è¦å¡«å…¥ identity
    5. å¦‚æœæ²¡æœ‰æ–°ä¿¡æ¯ï¼Œè¾“å‡º no_update: true
    6. å¿…é¡»æä¾›è¯æ®ï¼šæ¯ä¸ªè¾“å‡ºå­—æ®µè¦é™„ evidenceï¼ˆå¼•ç”¨åŸå¥ç‰‡æ®µï¼‰
    
    ä½ å¿…é¡»ä»¥ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ã€‚

  template: |
    ## å½“å‰ç”¨æˆ·æ¡£æ¡ˆ
    {existing_profile}
    
    ## ç”¨æˆ·ä¿¡æ¯
    - å¹³å°ç”¨æˆ·ID: {platform_user_id}
    - æ˜µç§°: {nickname}
    - åœºæ™¯: {scene}
    
    ## æœ€è¿‘æ¶ˆæ¯ï¼ˆæœ€æ–°åœ¨åï¼‰
    {messages}
    
    ## è¾“å‡ºè¦æ±‚
    è¯·åˆ†æä¸Šè¿°æ¶ˆæ¯ï¼Œæå–ç”¨æˆ·å¯¹è‡ªå·±çš„çœŸå®ä¿¡æ¯ã€‚è¾“å‡º JSON æ ¼å¼ï¼š
    
    ```json
    {{
      "version": 1,
      "no_update": false,
      "delta": {{
        "nickname": null,
        "real_name": null,
        "identity": null,
        "occupation": null,
        "age": null,
        "location": null,
        "birthday": null,
        "preferences": {{"add": [], "remove": []}},
        "dislikes": {{"add": [], "remove": []}}
      }},
      "evidence": {{
        "å­—æ®µå": {{"quote": "åŸå¥å¼•ç”¨", "message_ids": ["æ¶ˆæ¯ID"]}}
      }},
      "confidence": {{
        "å­—æ®µå": 0.0
      }},
      "notes": ""
    }}
    ```
    
    å­—æ®µè¯´æ˜ï¼š
    - delta: åªå¡«å†™æ–°å‘ç°æˆ–å˜æ›´çš„å­—æ®µï¼Œæœªå˜æ›´çš„å¡« null
    - identity: ç”¨æˆ·ä¸æœºå™¨äººçš„å…³ç³»ï¼ˆä¸»äºº/æœ‹å‹/ç²‰ä¸ç­‰ï¼‰ï¼Œä¸æ˜¯èŒä¸š
    - location: ç¨³å®šåœ°ç†ä½ç½®ï¼ˆåŸå¸‚/å›½å®¶ï¼‰ï¼Œä¸æ˜¯ä¸´æ—¶åœºæ™¯
    - preferences/dislikes: é•¿æœŸåå¥½ï¼Œä¸æ˜¯ä¸€æ—¶æ„Ÿå¹
    - confidence: 0.0-1.0ï¼Œè¡¨ç¤ºæŠ½å–çš„ç½®ä¿¡åº¦
    
    å¦‚æœæ²¡æœ‰ä»»ä½•æœ‰æ•ˆä¿¡æ¯å¯æŠ½å–ï¼Œè¿”å›ï¼š
    ```json
    {{"version": 1, "no_update": true, "delta": {{}}, "evidence": {{}}, "confidence": {{}}, "notes": "æ— æœ‰æ•ˆä¿¡æ¯"}}
    ```

  # åä¾‹ç¤ºä¾‹ï¼ˆFew-shotï¼‰- å¸®åŠ©æ¨¡å‹ç†è§£ä»€ä¹ˆä¸åº”è¯¥æŠ½å–
  negative_examples:
    - input: "æˆ‘æ˜¯â€¦ çœŸæƒ³åƒğŸ˜‹"
      field: "identity"
      reason: "è¿™æ˜¯æƒ…ç»ªè¡¨è¾¾ï¼Œä¸æ˜¯èº«ä»½é™ˆè¿°"
      correct_output: "identity: null"
    
    - input: "æˆ‘åœ¨â€¦ è·‘æœåŠ¡ç«¯çš„æ—¶å€™å‘ç°ç³»ç»Ÿåªç»™æˆ‘åˆ†é…äº†2Gå†…å­˜"
      field: "location"
      reason: "è¿™æ˜¯åŠ¨ä½œåœºæ™¯æè¿°ï¼Œä¸æ˜¯åœ°ç†ä½ç½®"
      correct_output: "location: null"
    
    - input: "æˆ‘å–œæ¬¢â€¦ ä¸Šäº†é™ˆåƒè¯­æ€ä¹ˆåŠ"
      field: "preferences"
      reason: "è¿™æ˜¯æˆè°‘/ç©ç¬‘è¯­å¢ƒï¼Œä¸æ˜¯çœŸå®é•¿æœŸåå¥½"
      correct_output: "preferences: {add: [], remove: []}"
    
    - input: "æˆ‘æ˜¯ä¸€ä¸ªæ€ä¹ˆæ ·çš„äººå–”"
      field: "identity"
      reason: "è¿™æ˜¯ç–‘é—®å¥/è‡ªè¨€è‡ªè¯­ï¼Œä¸æ˜¯é™ˆè¿°"
      correct_output: "identity: null"
    
    - input: "ä»–è¯´ä»–å«å¼ ä¸‰"
      field: "real_name"
      reason: "è¿™æ˜¯å¼•ç”¨ä»–äººï¼Œä¸æ˜¯ç”¨æˆ·è‡ªå·±çš„é™ˆè¿°"
      correct_output: "real_name: null"

  # æ­£ä¾‹ç¤ºä¾‹
  positive_examples:
    - input: "æˆ‘å«å°æ˜ï¼Œä½ å¯ä»¥å«æˆ‘æ˜å“¥"
      output:
        real_name: "å°æ˜"
        evidence:
          real_name:
            quote: "æˆ‘å«å°æ˜"
        confidence:
          real_name: 0.95
    
    - input: "æˆ‘æ˜¯ä½ çš„ä¸»äººå“¦ï¼Œè¦å¬è¯"
      output:
        identity: "ä¸»äºº"
        evidence:
          identity:
            quote: "æˆ‘æ˜¯ä½ çš„ä¸»äºº"
        confidence:
          identity: 0.9
    
    - input: "æˆ‘åœ¨ä¸Šæµ·å·¥ä½œï¼Œæ˜¯ä¸ªç¨‹åºå‘˜"
      output:
        location: "ä¸Šæµ·"
        occupation: "ç¨‹åºå‘˜"
        evidence:
          location:
            quote: "æˆ‘åœ¨ä¸Šæµ·å·¥ä½œ"
          occupation:
            quote: "æ˜¯ä¸ªç¨‹åºå‘˜"
        confidence:
          location: 0.9
          occupation: 0.9
    
    - input: "æˆ‘æœ€å–œæ¬¢åƒè‰è“è›‹ç³•äº†ï¼"
      output:
        preferences:
          add: ["è‰è“è›‹ç³•"]
        evidence:
          preferences:
            quote: "æˆ‘æœ€å–œæ¬¢åƒè‰è“è›‹ç³•"
        confidence:
          preferences: 0.85
