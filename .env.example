# =========================================
# Mika Bot 环境变量示例（复制为 .env / .env.prod）
# =========================================
# 说明：
# - 本文件只保留“必填 + 常用”配置，确保开箱即用
# - 更多高级配置请看 docs/api/config.md

# =========================
# NoneBot 基础配置（常用）
# =========================
DRIVER=~fastapi
HOST=0.0.0.0
PORT=8080
LOG_LEVEL=INFO
# 严格启动模式：true 时，适配器/插件加载失败将直接退出（默认 false，失败仅 warning 并降级）
# MIKA_STRICT_STARTUP=false

# =========================
# LLM Provider（必填其一）
# =========================
# 推荐使用新键：MIKA_LLM_*
# 兼容旧键：GEMINI_*（仍可用，但后续将逐步弃用）
MIKA_LLM_API_KEY=""
# MIKA_LLM_API_KEY_LIST=["key1", "key2"]

# Provider 类型：openai_compat / anthropic / google_genai
MIKA_LLM_PROVIDER="openai_compat"
# API 基础地址（openai_compat 常用；官方端点可留空）
MIKA_LLM_BASE_URL=""

# 模型名称（按你的账号可用模型调整）
MIKA_LLM_MODEL="gemini-3-pro-high"
MIKA_LLM_FAST_MODEL="gemini-2.5-flash-lite"

# =========================
# 身份与权限（必填）
# =========================
# 推荐使用新键：MIKA_MASTER_*
# 兼容旧键：GEMINI_MASTER_*（仍可用，但后续将逐步弃用）
# 你的 QQ 号（用于管理权限；不配置会直接启动失败）
MIKA_MASTER_ID=0

# 建议配置（非必填，但推荐）
MIKA_MASTER_NAME="Sensei"
MIKA_BOT_DISPLAY_NAME="Mika"

# 群白名单（留空=全允许）
# 注意：OneBot v12 的 group_id 可能是字符串，这里依然可以写数字或字符串
# MIKA_GROUP_WHITELIST=[123456789]

# =========================
# 可选：联网搜索
# =========================
# MIKA_SEARCH_PROVIDER="serper"   # serper / tavily
# MIKA_SEARCH_API_KEY=""

# =========================
# 可选：Core Runtime 模式（Stage C）
# =========================
# embedded：默认进程内模式（推荐）
# remote：通过 HTTP Core Service 调用核心（跨语言宿主准备）
# MIKA_CORE_RUNTIME_MODE="embedded"
# MIKA_CORE_REMOTE_BASE_URL="http://127.0.0.1:8080"
# MIKA_CORE_REMOTE_TIMEOUT_SECONDS=15
# MIKA_CORE_SERVICE_TOKEN=""

# =========================
# 可选：代理（外网受限环境）
# =========================
# HTTP_PROXY="http://127.0.0.1:7890"
# HTTPS_PROXY="http://127.0.0.1:7890"
# NO_PROXY="localhost,127.0.0.1"

# =========================
# 可选：可观测性
# =========================
# /metrics 是否启用 Prometheus 文本导出
# GEMINI_METRICS_PROMETHEUS_ENABLED=true
# /health 是否主动探测 API 连通性（默认关闭，避免额外开销）
# GEMINI_HEALTH_CHECK_API_PROBE_ENABLED=false
# GEMINI_HEALTH_CHECK_API_PROBE_TIMEOUT_SECONDS=3.0
# GEMINI_HEALTH_CHECK_API_PROBE_TTL_SECONDS=30

# =========================
# 高级：OneBot 兼容性（通常不需要改）
# =========================
# 离线消息同步通常依赖非标准 API（get_group_msg_history 等），默认关闭以提升兼容性
# GEMINI_OFFLINE_SYNC_ENABLED=false
# 长回复图文兜底（forward 或引用失败后，将文本渲染为图片发送）
# GEMINI_LONG_REPLY_IMAGE_FALLBACK_ENABLED=true
# GEMINI_LONG_REPLY_IMAGE_MAX_CHARS=12000
# GEMINI_LONG_REPLY_IMAGE_MAX_WIDTH=960
# GEMINI_LONG_REPLY_IMAGE_FONT_SIZE=24
# 兼容保留：历史分片配置，当前主链路不再使用
# GEMINI_LONG_MESSAGE_CHUNK_SIZE=800
# 空回复本地快速重试次数（仅传输层，不重跑整条业务链）
# GEMINI_EMPTY_REPLY_LOCAL_RETRIES=1
# 空回复本地重试间隔（秒）
# GEMINI_EMPTY_REPLY_LOCAL_RETRY_DELAY_SECONDS=0.4
# 传输层超时本地重试次数（仅重试超时，不重跑业务链）
# GEMINI_TRANSPORT_TIMEOUT_RETRIES=1
# 传输层超时重试间隔（秒）
# GEMINI_TRANSPORT_TIMEOUT_RETRY_DELAY_SECONDS=0.6
# 空回复是否触发业务级上下文降级重试（默认关闭，便于排障）
# GEMINI_EMPTY_REPLY_CONTEXT_DEGRADE_ENABLED=false
# 业务级上下文降级最大层级（仅在上项为 true 时生效）
# GEMINI_EMPTY_REPLY_CONTEXT_DEGRADE_MAX_LEVEL=2
# 上下文模式：legacy=历史兼容，structured=结构化（推荐）
# GEMINI_CONTEXT_MODE="structured"
# 上下文最大轮次（优先于按条数截断）
# GEMINI_CONTEXT_MAX_TURNS=30
# 上下文软 token 上限（估算）
# GEMINI_CONTEXT_MAX_TOKENS_SOFT=12000
# 是否启用上下文摘要压缩（默认关闭）
# GEMINI_CONTEXT_SUMMARY_ENABLED=false
# 多模态严格模式（清理不合法历史消息块）
# GEMINI_MULTIMODAL_STRICT=true
# 引用图片说明（best-effort）
# GEMINI_QUOTE_IMAGE_CAPTION_ENABLED=true
# 引用图片说明模板（仅构造文本，不触发额外模型调用）
# GEMINI_QUOTE_IMAGE_CAPTION_PROMPT="[引用图片共{count}张]"
# 引用消息解析超时（秒）
# GEMINI_QUOTE_IMAGE_CAPTION_TIMEOUT_SECONDS=3.0
# 上下文 trace 日志（采样）
# GEMINI_CONTEXT_TRACE_ENABLED=false
# GEMINI_CONTEXT_TRACE_SAMPLE_RATE=1.0
# Active Reply（LTM 风格）门控
# GEMINI_ACTIVE_REPLY_LTM_ENABLED=true
# GEMINI_ACTIVE_REPLY_PROBABILITY=1.0
# GEMINI_ACTIVE_REPLY_WHITELIST=["123456789"]
